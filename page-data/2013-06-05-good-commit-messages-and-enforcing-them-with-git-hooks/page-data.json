{"componentChunkName":"component---gatsby-theme-code-notes-src-templates-note-js","path":"/2013-06-05-good-commit-messages-and-enforcing-them-with-git-hooks","result":{"data":{"mdx":{"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"emoji\": \"✏️\",\n  \"title\": \"Good Commit Messages And Enforcing Them With Git Hooks\",\n  \"modified\": \"2013-06-05T00:00:00.000Z\",\n  \"tags\": [\"git\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Git provides a very valuable feature that many developers seem to either overlook or blatantly not care about; it enables you to add distinct sections to a commit message. Specifically, it allows you to add a short summary for the commit and a long and detailed body.\"), mdx(\"p\", null, \"A great commit message:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-markdown\"\n  }), \"Capitalized, short (50 chars or less) summary\\n\\nMore detailed explanatory text, if necessary.  Wrap it to about 72\\ncharacters or so.  In some contexts, the first line is treated as the\\nsubject of an email and the rest of the text as the body.  The blank\\nline separating the summary from the body is critical (unless you omit\\nthe body entirely); tools like rebase can get confused if you run the\\ntwo together.\\n\\nWrite your commit message in the imperative: \\\"Fix bug\\\" and not \\\"Fixed bug\\\"\\nor \\\"Fixes bug.\\\"  This convention matches up with commit messages generated\\nby commands like git merge and git revert.\\n\\nFurther paragraphs come after blank lines.\\n\\n- Bullet points are okay, too\\n\\n- Typically a hyphen or asterisk is used for the bullet, preceded by a\\n  single space, with blank lines in between, but conventions vary here\\n\\n- Use a hanging indent\\n\")), mdx(\"p\", null, \"Key points of a well formed commit message:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Must have a summary line\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Summary line must be 50 characters or less\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Should have a well thought out and meaningful description\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"No line in the description should be over 72 characters long\")), mdx(\"p\", null, \"Format breakdown:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"First line is summary\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Second line is empty\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Third line starts the in-depth description\")), mdx(\"p\", null, \"Be sure to write your summary in the present tense imperative. For example, instead of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Adds new copy to homepage\"), \" use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Add new copy to homepage\"), \" or instead of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Fixes bug #234234\"), \" use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Fix bug #234234\"), \". This folows the convention that git itself uses. Have you ever noticed when you merge a branch the commit message is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Merge [branch]\"), \" and not \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Merges [branch]\"), \" or \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Merged [branch]\"), \"?\"), mdx(\"h2\", {\n    \"id\": \"why\"\n  }, \"Why?\"), mdx(\"p\", null, \"A lot of this info comes from a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html\"\n  }), \"great blog post\"), \" by Tim Pope in 2008. I didn't make the rules I just follow them\\u2122. Various git commands pull the summary automatically and will just truncate your commit message if it is too long. This makes scanning the commit history very cumbersome and annoying. Commit summaries allow you to quickly convey the full intent of the commit in a single and succinct line. Think of it like the subject line of an email.\"), mdx(\"p\", null, \"Yesterday I was needing a break from normal work and decided to work on some git hooks that would make me follow these rules.  \"), mdx(\"p\", null, \"Git provides several hooks into git events for you to do some pre-defined action prior to or immediately after a commit.\"), mdx(\"p\", null, \"{% highlight bash %}\\n\", \"[master][~/dev]\", \" ls .git/hooks\\napplypatch-msg.sample     post-update.sample        pre-commit.sample         prepare-commit-msg.sample\\ncommit-msg.sample         pre-applypatch.sample     pre-rebase.sample         update.sample\\n{% endhighlight %}\"), mdx(\"p\", null, \"I want to validate the commit message after the user creates the message but prior to it being committed to the repository. The specific hook I need for this is the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"commit-msg\"), \" hook. If you remove the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".sample\"), \" from these files git will run them at their appropriate times. They are shell scripts and I could have written my message checker in a shell script like bash but I'm really not good at awk and sed and all that crazy shell scripting voodoo. So I just use the commit-msg shell script to call my own python script.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"commit-msg\\n#!/bin/sh\\n\\nexec < /dev/tty\\n.git/hooks/validate-commit.py $1\\n\")), mdx(\"p\", null, \"What I want this script to do:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Verify I have a summary line on my commit\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Verify the summary line is not over 50 characters\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Verify no line is over 72 characters\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If there are any errors, reject my commit and ask me to reformat\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If I choose to reformat my commit, bring me back into the commit editor and show me what exactly was wrong with my commit in comments on the commit message\")), mdx(\"p\", null, \"After a few beers and some tinkering I ended up with this messy bit of python code:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-python\"\n  }), \"#!/usr/bin/python\\n\\nimport sys, os\\nfrom subprocess import call\\n\\nprint os.environ.get('EDITOR')\\n\\nif os.environ.get('EDITOR') != 'none':\\n  editor = os.environ['EDITOR']\\nelse:\\n  editor = \\\"vim\\\"\\n\\nmessage_file = sys.argv[1]\\n\\ndef check_format_rules(lineno, line):\\n    real_lineno = lineno + 1\\n    if lineno == 0:\\n        if len(line) > 50:\\n            return \\\"Error %d: First line should be less than 50 characters \\\" \\\\\\n                    \\\"in length.\\\" % (real_lineno,)\\n    if lineno == 1:\\n        if line:\\n            return \\\"Error %d: Second line should be empty.\\\" % (real_lineno,)\\n    if not line.startswith('#'):\\n        if len(line) > 72:\\n            return \\\"Error %d: No line should be over 72 characters long.\\\" % (\\n                    real_lineno,)\\n    return False\\n\\n\\nwhile True:\\n    commit_msg = list()\\n    errors = list()\\n    with open(message_file) as commit_fd:\\n        for lineno, line in enumerate(commit_fd):\\n            stripped_line = line.strip()\\n            commit_msg.append(line)\\n            e = check_format_rules(lineno, stripped_line)\\n            if e:\\n                errors.append(e)\\n    if errors:\\n        with open(message_file, 'w') as commit_fd:\\n            commit_fd.write('%s\\\\n' % '# GIT COMMIT MESSAGE FORMAT ERRORS:')\\n            for error in errors:\\n                commit_fd.write('#    %s\\\\n' % (error,))\\n            for line in commit_msg:\\n                commit_fd.write(line)\\n        re_edit = raw_input('Invalid git commit message format.  Press y to edit and n to cancel the commit. [y/n]')\\n        if re_edit.lower() in ('n','no'):\\n            sys.exit(1)\\n        call('%s %s' % (editor, message_file), shell=True)\\n        continue\\n    break\\n\")), mdx(\"p\", null, \"Now if I try to commit a badly formed commit message like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"COMMIT_EDITMSG\\nCurabitur blandit tempus porttitor. Nullam quis risus eget urna mollis\\nornare vel eu leo. Nullam id dolor id nibh ultricies vehicula ut id\\nelit. Cras mattis consectetur purus sit amet fermentum. Maecenas\\nfaucibus mollis interdum. Etiam porta sem malesuada magna mollis\\neuismod. Nulla vitae elit libero, a pharetra augue.\\n\\nDonec ullamcorper nulla non metus auctor fringilla. Praesent commodo\\ncursus magna, vel scelerisque nisl consectetur et. Sed posuere consectetur est at lobortis. Maecenas sed diam eget risus varius blandit\\nsit amet non magna.\\n\\n# Please enter the commit message for your changes. Lines starting\\n# with '#' will be ignored, and an empty message aborts the commit.\\n# On branch master\\n# Changes to be committed:\\n#   (use \\\"git reset HEAD <file>...\\\" to unstage)\\n#\\n#>      new file:   31234\\n#\\ndiff --git a/31234 b/31234\\nnew file mode 100644\\nindex 0000000..e69de29\\n\")), mdx(\"p\", null, \"It will kick me back to the shell prompt me with this message: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Invalid git commit message format.  Press y to edit and n to cancel the commit. [y/n]\")), mdx(\"p\", null, \"Once you press \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"y\"), \" to edit your commit it will kick you back to your commit and allow you to fix the bad formatting \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"and\"), \" even tell you which lines were incorrect and why!\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"COMMIT_EDITMSG\\nCurabitur blandit tempus porttitor. Nullam quis risus eget urna mollis\\nornare vel eu leo. Nullam id dolor id nibh ultricies vehicula ut id\\nelit. Cras mattis consectetur purus sit amet fermentum. Maecenas\\nfaucibus mollis interdum. Etiam porta sem malesuada magna mollis\\neuismod. Nulla vitae elit libero, a pharetra augue.\\n\\nDonec ullamcorper nulla non metus auctor fringilla. Praesent commodo\\ncursus magna, vel scelerisque nisl consectetur et. Sed posuere consectetur est at lobortis. Maecenas sed diam eget risus varius blandit\\nsit amet non magna.\\n\\n# GIT COMMIT MESSAGE FORMAT ERRORS:\\n#    Error 1: First line should be less than 50 characters in length.\\n#    Error 2: Second line should be empty.\\n#    Error 7: No line should be over 72 characters long.\\n\\n# Please enter the commit message for your changes. Lines starting\\n# with '#' will be ignored, and an empty message aborts the commit.\\n# On branch master\\n# Changes to be committed:\\n#   (use \\\"git reset HEAD <file>...\\\" to unstage)\\n#\\n#>      new file:   1234098\\n#\\ndiff --git a/1234098 b/1234098\\nnew file mode 100644\\nindex 0000000..e69de29\\n\")), mdx(\"p\", null, \"This tells us that we have errors on line 1, 2 and 7 of our commit. I've accomplished everything I set out to and now I'll be forced to follow good practices on my commit messages.\"), mdx(\"p\", null, \"I actually wrote this initially in Ruby, if you know me you know I am definitely not a python programmer, but had some problems I couldn't figure out with forking subprocesses for the editor after a second commit rejection. I needed it to stay in the error loop and check the message again but if you rejected your commit and then tried to use the exact same message with the errors again, it would succeed and commit to the repository. Someday soon I'll dig into that more but for now this python script will certainly do!\"), mdx(\"p\", null, \"Do you follow any guidelines on commit message format?\"));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"Good Commit Messages And Enforcing Them With Git Hooks","tags":["git"],"emoji":"✏️","modified":"June 5, 2013","modifiedTimestamp":"2013-06-05T00:00:00.000Z"},"references":[],"fields":{"slug":"/2013-06-05-good-commit-messages-and-enforcing-them-with-git-hooks"},"tableOfContents":{"items":[{"url":"#why","title":"Why?"}]},"parent":{"relativePath":"2013-06-05-good-commit-messages-and-enforcing-them-with-git-hooks.md"}}},"pageContext":{"id":"79b520e4-efc0-59ad-8f56-5498cba5cd58","previous":{"id":"25e79edf-00a8-5ea0-9c76-3b7902fbcef3","frontmatter":{"title":"Hiding Your Desktop Icons For A Presentation On OS X","tags":["osx","applescript","protips"]},"fields":{"slug":"/2013-05-25-hiding-your-desktop-icons-for-a-presentation-on-os-x"}},"next":{"id":"771d0ef5-be9e-5a7d-9f44-5db87d08a558","frontmatter":{"title":"Well, I Just Submitted My First Abstract To Speak At A Conference","tags":["talks"]},"fields":{"slug":"/2012-08-09-well-i-submitted-my-first-abstract-for-a-conference-talk"}},"hasUntagged":false,"basePath":"/","tags":[{"tag":"DIY","totalCount":1,"slug":"/diy","path":"/tag/diy"},{"tag":"LaTeX","totalCount":1,"slug":"/la-te-x","path":"/tag/la-te-x"},{"tag":"applescript","totalCount":2,"slug":"/applescript","path":"/tag/applescript"},{"tag":"ci","totalCount":1,"slug":"/ci","path":"/tag/ci"},{"tag":"facebook","totalCount":1,"slug":"/facebook","path":"/tag/facebook"},{"tag":"git","totalCount":2,"slug":"/git","path":"/tag/git"},{"tag":"ios","totalCount":3,"slug":"/ios","path":"/tag/ios"},{"tag":"jekyll","totalCount":1,"slug":"/jekyll","path":"/tag/jekyll"},{"tag":"lessons-learned","totalCount":1,"slug":"/lessons-learned","path":"/tag/lessons-learned"},{"tag":"networking","totalCount":1,"slug":"/networking","path":"/tag/networking"},{"tag":"objective-c","totalCount":1,"slug":"/objective-c","path":"/tag/objective-c"},{"tag":"osx","totalCount":1,"slug":"/osx","path":"/tag/osx"},{"tag":"process","totalCount":1,"slug":"/process","path":"/tag/process"},{"tag":"protips","totalCount":1,"slug":"/protips","path":"/tag/protips"},{"tag":"resume","totalCount":1,"slug":"/resume","path":"/tag/resume"},{"tag":"safari","totalCount":1,"slug":"/safari","path":"/tag/safari"},{"tag":"security","totalCount":1,"slug":"/security","path":"/tag/security"},{"tag":"spotify","totalCount":1,"slug":"/spotify","path":"/tag/spotify"},{"tag":"talks","totalCount":2,"slug":"/talks","path":"/tag/talks"},{"tag":"travis ci","totalCount":1,"slug":"/travis-ci","path":"/tag/travis-ci"},{"tag":"webdev","totalCount":1,"slug":"/webdev","path":"/tag/webdev"}],"pages":[]}},"staticQueryHashes":["1308211557","2744905544","467212769"]}